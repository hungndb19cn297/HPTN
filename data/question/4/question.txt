{"content":"<h1 id=\"1giithiu\">1. Giới thiệu</h1><p>Zabbix là gì ?</p><p><img src=\"https://images.viblo.asia/a97d3f97-6eb6-47b6-8855-b9863aaffa8a.png\" alt=\"\" /></p><p>Zabbix là một phần mềm mã nguồn mở được sử dụng để giám sát và quản lý hệ thống, mạng, ứng dụng và các tài nguyên khác trong môi trường máy tính. Nó cho phép bạn theo dõi các chỉ số khác nhau, như tài nguyên hệ thống, hiệu suất ứng dụng, băng thông mạng và nhiều thông số khác để đảm bảo rằng hệ thống của bạn hoạt động ổn định và đáp ứng đúng yêu cầu.</p><p><img src=\"https://images.viblo.asia/b46d54f7-ea6a-4434-b267-6bd1e2fc4bb2.png\" alt=\"\" /></p><p><img src=\"https://images.viblo.asia/25698b0e-be63-43b9-842a-b3b765873ff5.png\" alt=\"\" /></p><p>Oracle Linux là một hệ điều hành open source của Oracle, mình sẽ dùng hệ điều hành này để cài đặt Zabbix, phiên bản của hệ điều hành là 7.9.</p><h1 id=\"2hngdncit\">2. Hướng dẫn Cài đặt</h1><h2 id=\"21vhiuhaselinux\">2.1 Vô hiệu hóa SELinux</h2><p>Mở file SELinux cấu hình và chỉnh sửa theo nội dung sau:</p><pre><code>vim /etc/sysconfig/selinux<br/></code></pre><p>Đổi “SELINUX=thực thi” thành “SELINUX=vô hiệu hóa”</p><h2 id=\"22citvcuhnhapache\">2.2 Cài đặt và cấu hình Apache</h2><p>Sử dụng các lệnh sau:</p><pre><code>yum -y install httpd<br/></code></pre><p>Kiểm tra tình trạng httpd.</p><pre><code>systemctl status httpd.service<br/></code></pre><p>Nếu dịch vụ Apache không chạy, hãy khởi động thủ công.</p><pre><code>systemctl start httpd.service<br/></code></pre><p><img src=\"https://images.viblo.asia/378b706f-5f4a-4735-9e01-59df24f5824d.png\" alt=\"\" /></p><pre><code>systemctl enable httpd<br/></code></pre><h2 id=\"23installphpcinykhlulmlycaferichnhamingi\">2.3 Install PHP ( Cái này khá lâu - Làm ly cafe rồi chờ nha mọi người)</h2><pre><code>yum install -y php php-pear php-cgi php-common php-mbstring php-snmp php-gd php-pecl-mysql php-xml php-mysql php-gettext php-bcmath<br/></code></pre><p>Sửa đổi Múi giờ PHP bằng cách chỉnh sửa tệp php.ini.</p><pre><code>vim /etc/php.ini<br/></code></pre><p>Bỏ ghi chú dòng sau và thêm múi giờ của bạn.</p><pre><code>date.timezone = Asia/Ho_Chi_Minh<br/></code></pre><p><img src=\"https://images.viblo.asia/3149f6d6-304e-47f1-ad9c-cb7a4e8db93b.png\" alt=\"\" /></p><h2 id=\"24citmariadb\">2.4 Cài đặt MariaDB</h2><pre><code>yum install -y mariadb-server<br/></code></pre><p>Bắt đầu dịch vụ MariaDB.</p><pre><code>systemctl start mariadb.service<br/></code></pre><p>Bật MariaDB khi khởi động hệ thống.</p><pre><code>systemctl enable mariadb<br/></code></pre><p>Kiểm tra MariaDB khi khởi động hệ thống.</p><pre><code>systemctl status mariadb.service<br/></code></pre><p><img src=\"https://images.viblo.asia/2094d4ab-e87f-45f1-9d61-0aec85dd9413.png\" alt=\"\" /></p><p>Chạy lệnh sau để bảo mật MariaDB.</p><pre><code>mysql_secure_installation<br/></code></pre><p>Nhấn enter cho lần cài đầu tiên</p><p><img src=\"https://images.viblo.asia/9e3c83f0-588f-4e2f-9dc0-5ace2eda664a.png\" alt=\"\" /></p><p>Sau đó nhập Password cho user root: vd: 123456789Zabbix!01</p><p><img src=\"https://images.viblo.asia/58cc144b-540a-4f7b-a4b9-07d09b7719c1.png\" alt=\"\" /></p><p>Truy cập Database</p><pre><code>**mysql -u root -p**<br/></code></pre><p>Nhập mật khẩu đã tạo ở trên.</p><h2 id=\"25tocsdliuchozabbix\">2.5 Tạo cơ sở dữ liệu cho Zabbix</h2><p>Bạn có thể chọn bất kỳ tên nào cho cơ sở dữ liệu thay cho zabbix database trong lệnh dưới đây:</p><pre><code>MYSQL&amp;gt; Create database zabbix_database;<br/></code></pre><p>Tạo người dùng DB và cấp đặc quyền.</p><pre><code>MYSQL&amp;gt; create user 'zabbixuser'@'localhost' identified BY '123456789Zabbix!01';<br/>MYSQL&amp;gt; grant all privileges on zabbix_database.* to zabbixuser@localhost ;<br/>MYSQL&amp;gt; flush privileges;<br/></code></pre><h2 id=\"26citzabbixvccpackagelinquan\">2.6 Cài đặt Zabbix và các package liên quan</h2><p>Thêm repo Zabbix. Sao chép URL tải xuống mới nhất từ ​​trang web chính thức trang mạng. Dán nó vào lệnh dưới đây một cách thích hợp.</p><pre><code>rpm -ivh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm ( Có thể thay đổi để thay đổi phiên bản )<br/></code></pre><pre><code>rpm -ivh https://repo.zabbix.com/zabbix/6.4/rhel/7/x86_64/zabbix-phát hành-mới nhất.el7.noarch.rpm<br/></code></pre><p>Cài đặt Zabbix.</p><pre><code>yum install -y zabbix-server-mysql zabbix-web-mysql zabbix-agent zabbix-get<br/></code></pre><p><img src=\"https://images.viblo.asia/894bd096-a44a-441d-a00c-f331df0e3355.png\" alt=\"\" /></p><h2 id=\"27nhcuhnhzabbix\">2.7 Định cấu hình Zabbix</h2><p>Thay đổi Múi giờ bằng cách chỉnh sửa tệp cấu hình Zabbix Apache.</p><pre><code>vim /etc/httpd/conf.d/zabbix.conf<br/></code></pre><p>Bỏ ghi chú dòng sau và thêm Múi giờ của bạn.</p><pre><code>php_value date.timezone Asia/Ho_Chi_Minh<br/>Các tham số PHP sẽ giống như sau:<br/>php_value max_execution_time 300<br/>php_value memory_limit 128M<br/>php_value post_max_size 16M<br/>php_value upload_max_filesize 2M<br/>php_value max_input_time 300<br/>php_value max_input_vars 10000<br/>php_value always_populate_raw_post_data -1<br/>php_value date.timezone Asia/Ho_Chi_Minh<br/></code></pre><p><img src=\"https://images.viblo.asia/2476efd3-829c-4fae-815b-9f11170c1b40.png\" alt=\"\" /></p><p>Khởi động lại dịch vụ HTTPD.</p><pre><code>systemctl restart httpd.service<br/></code></pre><p>Gói cài đặt Zabbix cung cấp tệp SQL bao gồm lược đồ và dữ liệu ban đầu cho máy chủ Zabbix với MySQL.</p><p>Thay đổi thư mục và chuyển đến thư mục Zabbix.</p><pre><code>cd /usr/share/doc/zabbix-server-mysql-4.0.X ( X có thể thay đổi)<br/></code></pre><p>Nhập tệp kết xuất MySQL.</p><pre><code>zcat create.sql.gz | mysql -u zabbixuser -p zabbix_database<br/></code></pre><p><img src=\"https://images.viblo.asia/8804ab87-f553-4083-a794-f67c7fc58e6c.png\" alt=\"\" /></p><p>Bây giờ hãy sửa đổi tệp cấu hình Zabbix với chi tiết Cơ sở dữ liệu.</p><pre><code>vim /etc/zabbix/zabbix_server.conf<br/></code></pre><p>Sửa đổi các thông số sau</p><pre><code>DBHost=localhost<br/>DBName=zabbix_database<br/>DBUser=zabbixuser<br/>DBPassword=@dfEr234KliT90<br/></code></pre><p>Bắt đầu dịch vụ Zabbix.</p><pre><code>systemctl start zabbix-server.service<br/></code></pre><p>Sau đó lưu và thoát tệp. Khởi động lại dịch vụ Zabbix.</p><pre><code>systemctl status zabbix-server.service<br/></code></pre><p><img src=\"https://images.viblo.asia/42e073af-bc73-4c8f-9f71-34129ae4ac40.png\" alt=\"\" /></p><p>Kích hoạt Zabbix khi khởi động hệ thống.</p><pre><code>systemctl enable zabbix-server.service<br/></code></pre><p>Sửa đổi quy tắc tường lửa.</p><pre><code>firewalld-cmd --add-service={http,https} -- Permanent<br/>firewalld-cmd --add-port={10051/tcp,10050/tcp} -- Permanent<br/>firewalld-cmd --reload<br/></code></pre><p>Bây giờ khởi động lại dịch vụ httpd.</p><pre><code>systemctl restart httpd<br/></code></pre><h2 id=\"28citzabbix\">2.8 Cài đặt Zabbix</h2><p>Bạn có thể truy cập Zabbix bằng URL sau:</p><p>http://Server-Host-Name Hoặc IP /zabbix/</p><p>Bạn sẽ thấy trang welcome page.</p><p><img src=\"https://images.viblo.asia/53b8739a-2dcf-45c4-993a-14e784385d4a.png\" alt=\"image.png\" /></p><p>Next một hồi cái bị lỗi này.</p><p><img src=\"https://images.viblo.asia/79962113-6731-4295-8d6b-7de9d4eeb1d9.png\" alt=\"image.png\" /></p><p>Bạn tham khảo link này để fix lỗi này nhé</p><p>Xem như vừa rồi là một bài tập làm quen với Mysql/Mariadb nhé Hehe</p><p>Đặt tên name: ví dụ zabbix.&lt;domain&gt;.com</p><p><img src=\"https://images.viblo.asia/eba98886-152f-47e3-b023-e8c2a07a063b.png\" alt=\"\" /></p><p>Có thể bạn sẽ vào được tài khoản mặc định là admin / zabbix. Còn nếu không được thì tham khảo mục Error để xem cách cài đặt password cho user Admin này.<br/>    <img src=\"https://images.viblo.asia/a8d6281c-e5cc-4e70-9a78-fd20242d4f3e.png\" alt=\"image.png\" /></p><p>Tada như vậy là ta đã login vào được trang chủ quản trị của Zabbix rồi. Việc tiếp theo cần làm đó là cài đặt Zabbix Agent để theo dõi các hệ thống nhé.<br/>    <img src=\"https://images.viblo.asia/77f5f264-0943-4321-afa9-3f998bd357e6.png\" alt=\"\" /></p><h2 id=\"29cuhnhqunlbngzabbixagent\">2.9 Cấu hình để quản lý bằng Zabbix Agent</h2><p>Zabbix Agent thu thập dữ liệu từ máy khách và gửi chúng đến Zabbix Server. Ta sẽ cài đặt Zabbix Agent trên một server Oracle Linux khác để theo dõi nó.</p><pre><code>wget https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-2.el7.noarch.rpm<br/></code></pre><p>Cài đặt Zabbix Agent.</p><pre><code>yum install -y zabbix-agent<br/></code></pre><p>Bây giờ hãy sửa đổi agent configuration file.</p><pre><code>vim /etc/zabbix/zabbix_agentd.conf<br/></code></pre><p>Sửa đổi các thông số sau. Thêm dải IP và tên máy chủ bằng tên của bạn trong lệnh bên dưới:</p><pre><code>Server=127.0.0.1,192.168.113.0/24 ( Ở đây mình đặt 1 dải IP cùng lớp mạng)<br/>ServerActive=127.0.0.1,192.168.113.8 (IP MÁY CHỦ ZABBIX)<br/>Hostname =( HOSTNAME CLIENT )<br/></code></pre><p>Lưu và thoát tệp.</p><p>Restart Zabbix agent.</p><pre><code>systemctl restart zabbix-agent<br/></code></pre><p>Enable on system boot.</p><pre><code>systemctl enable zabbix-agent<br/></code></pre><h2 id=\"210thmhosttrnzabbixserver\">2.10 Thêm Host trên Zabbix server</h2><p>Click Configuration → Hosts → Create host</p><p><img src=\"https://images.viblo.asia/0fcbbaeb-21de-4467-bd8c-76ef1d38d3a3.png\" alt=\"\" /></p><p><img src=\"https://images.viblo.asia/11a5f307-a237-41ce-9c57-3489027fc436.png\" alt=\"\" /></p><p>Chỗ Hostname phải trung với chỗ mà bạn đặt biến Hostname cho Zabbix Agent ở mục 9</p><p><img src=\"https://images.viblo.asia/5cf9de70-aad6-42e7-86ff-729b187422ba.png\" alt=\"\" /></p><p>Chọn Template OS Linux → Add → Update</p><p><img src=\"https://images.viblo.asia/6dfa533f-dc0b-46ec-a8fe-c768da3f3656.png\" alt=\"\" /></p><p>Kiểm tra Host remote đã add chưa :</p><p>Click Monitoring → Graph → Click theo tùy chọn như bên dưới.<br/>    <img src=\"https://images.viblo.asia/ec772c9f-600e-4674-8981-97ce3201c932.png\" alt=\"\" /></p><p>Các bạn cứ cài Zabbix Agent và Create Host để quản lý các server khác nhé. Chúc mừng bạn nếu đã đi đến bước này thì bạn đã thành công được 1 /3 đoạn đường rồi. Nếu có bất kỳ lỗi nào thì xem ở mục Error, mình thống kê các lỗi mình gặp trong lúc cài đặt và cách fix để các bạn tham khảo.</p><p>Có một cách cài Zabbix cũng rất mau lẹ, đó là xài Docker và sử dụng image có sẵn từ cộng đồng. Cái này mình sẽ làm ở một bài viết khác nhé. Tuy nhiên khuyến khích các bạn nên cài thử như mình trước để hiểu cấu trúc và cách kết nối Zabbix, hiểu hơn khi cài Zabbix cần có gì để khi nếu sau này xảy ra lỗi ta vẫn còn biết để khoanh vùng sửa lỗi bạn nhé.</p><h1 id=\"3li\">3. Lỗi</h1><p>mysql<em>secure</em>installation</p><p>ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)</p><p>fix: Nhấn Enter đến khi pass qua</p><p>Error: Không đăng nhập được User<br/>    <img src=\"https://images.viblo.asia/1973a121-3716-428e-a755-a0a6a4474795.png\" alt=\"\" /></p><p>sửa chữa:https://cuongquach.com/reset-mat-khau-admin-zabbix-bang-sql-command.html</p><pre><code>mysql -u root -p<br/></code></pre><p>Enter password</p><pre><code>mysql&amp;gt; use zabbix_database<br/>mysql&amp;gt; update users set passwd=md5('123456789Zabbix!01') where alias='Admin';<br/></code></pre><p>tk Admin mk 123456789Zabbix!01</p><h1 id=\"4kt\">4. Kết</h1><p>Như vậy là đã kết thúc bài viết tuần này. Zabbix là gì, cài đặt như thế nào thì mình nghĩ các bạn đã hiểu được. Với công cụ này mình nghĩ các bạn sẽ quản lý network, phần cứng tốt hơn, trực quan hơn.</p><p>Bên cạnh đó Zabbix còn hỗ trợ rất nhiều các API, plugin, template để quản lý. Cái này thì các bạn tham khảo link này để tìm hiểu thêm nha.</p><p>Hãy upvote bài viết này. Cho mình 1 like 1 share và ghé trang https://beatcomputer.com để có thêm nhiều bài viết hữu ích khác nhé.</p><h1 id=\"5ccbivitthamkho\">5. Các bài viết tham khảo</h1><p>https://blog.cloud365.vn/monitor/zabbix4-thiet-lap-canh-bao-qua-email/</p><p>https://viblo.asia/p/zabbix-incorrect-characterset-for-zabbix-database-latin1-instead-utf8-utf8mb3-EoW4oRZXVml</p><p>https://amionrails.wordpress.com/2018/03/29/how-to-change-timezone-for-zabbix-frontend-gui/</p>","title":"[Zabbix] - Cài đặt Zabbix 4.0 trên RHL7/Oracle Linux","tags":["monitor-zabbix","Zabbix","zabbix-agent"],"created_at":1691902800000,"updated_at":1691983503000,"comments":[]}