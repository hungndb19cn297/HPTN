{"content":"<h1 id=\"hngdnuploadnhvvideotrongreactquillsdngcloudinary\">Hướng dẫn Upload ảnh và video trong React Quill sử dụng Cloudinary</h1><h3 id=\"1giithiu\">1.Giới thiệu:</h3><p>Trong quá trình phát triển ứng dụng web hoặc trang blog, việc cung cấp một trình soạn thảo phong phú cho người dùng là một nhu cầu phổ biến. Điều này cho phép người dùng tạo, chỉnh sửa và định dạng nội dung của họ một cách linh hoạt và dễ dàng. Một trong những trình soạn thảo phổ biến trong cộng đồng lập trình là React Quill, với khả năng tùy chỉnh cao và dễ tích hợp vào dự án React của bạn.</p><p>Tuy nhiên, việc cho phép người dùng tải lên và chèn hình ảnh, video vào trình soạn thảo không phải là điều đơn giản. Đặc biệt khi bạn cần lưu trữ và quản lý hàng ngàn tệp đa phương tiện. Giải pháp là sử dụng dịch vụ lưu trữ hình ảnh đám mây mạnh mẽ như Cloudinary. Cloudinary cho phép bạn lưu trữ, tải lên, và quản lý hình ảnh, video một cách hiệu quả, giúp ứng dụng của bạn tăng cường tính năng và hiệu suất.</p><p>Trong bài viết này, chúng ta sẽ tìm hiểu cách tích hợp React Quill với dịch vụ lưu trữ hình ảnh Cloudinary để giải quyết vấn đề phức tạp này. Chúng ta sẽ cùng nhau xây dựng một trình soạn thảo cho phép người dùng tải lên và chèn hình ảnh, video một cách thuận tiện và nhanh chóng.</p><ul><li>React Quill: Là một trình soạn thảo mã nguồn mở cho phép người dùng tạo, chỉnh sửa nội dung với định dạng đa dạng.</li><li>Cloudinary: Dịch vụ lưu trữ đám mây mạnh mẽ hỗ trợ quản lý, tải lên, xử lý hình ảnh và video một cách dễ dàng.</li></ul><h3 id=\"2citreactquill\">2. Cài đặt react-quill</h3><ul><li>Đầu tiên chúng ta cần khởi tạo project react bằng vite hoặc create-react-app</li></ul><pre><code>yarn create vite react-quill-upload --template react-ts<br/></code></pre><ul><li>Cài đặt react-quill :</li></ul><pre><code>yarn add react-quill<br/></code></pre><ul><li>Import react-quill component:</li></ul><pre><code>import React, { useState } from 'react';<br/>import ReactQuill from 'react-quill';<br/>import 'react-quill/dist/quill.snow.css';<br/>function MyComponent() {<br/>  const [value, setValue] = useState('');<br/>  const reactQuillRef = useRef&amp;lt;ReactQuill&amp;gt;(null);<br/>  return &amp;lt;ReactQuill ref={reactQuillRef} theme=\"snow\" value={value} onChange={setValue} /&amp;gt;;<br/>}<br/></code></pre><ul><li>Để upload image trong quill editor, chúng ta cần khai báo image vào phần module và formats</li></ul><pre><code>&amp;lt;ReactQuill<br/>      ref={reactQuillRef}<br/>      theme=\"snow\"<br/>      placeholder=\"Start writing...\"<br/>      modules={{<br/>        toolbar: {<br/>          container: [<br/>            [{ header: \"1\" }, { header: \"2\" }, { font: [] }],<br/>            [{ size: [] }],<br/>            [\"bold\", \"italic\", \"underline\", \"strike\", \"blockquote\"],<br/>            [<br/>              { list: \"ordered\" },<br/>              { list: \"bullet\" },<br/>              { indent: \"-1\" },<br/>              { indent: \"+1\" },<br/>            ],<br/>            [\"link\", \"image\", \"video\"],<br/>            [\"code-block\"],<br/>            [\"clean\"],<br/>          ],<br/>        },<br/>        clipboard: {<br/>          matchVisual: false,<br/>        },<br/>      }}<br/>      formats={[<br/>        \"header\",<br/>        \"font\",<br/>        \"size\",<br/>        \"bold\",<br/>        \"italic\",<br/>        \"underline\",<br/>        \"strike\",<br/>        \"blockquote\",<br/>        \"list\",<br/>        \"bullet\",<br/>        \"indent\",<br/>        \"link\",<br/>        \"image\",<br/>        \"video\",<br/>        \"code-block\",<br/>      ]}<br/>      value={value}<br/>      onChange={onChange}<br/>    /&amp;gt;<br/></code></pre><ul><li>Lúc này bạn sẽ thấy icon upload image trên thanh công cụ của react-quill. Hãy import thử và in giá trị của toàn bộ văn bản ra, bạn sẽ thấy rằng mặc định react-quill sẽ lưu ảnh của bạn dưới dạng base-64:</li></ul><p><img src=\"https://images.viblo.asia/8bbe64df-aa72-4018-8e23-36d70d8cee75.png\" alt=\"image.png\" /></p><p>&gt; =&gt; nếu sử dụng theo cách mặc định này, chúng ta hoàn toàn có thể lưu trữ ảnh trong database dưới dạng base 64, trong demo mình chỉ sử dụng ảnh với kích thước nhỏ, nếu ảnh càng lớn string base-64 sẽ càng lớn, như thế sẽ rất tốn bộ nhớ.</p><h3 id=\"3handleuploadimage\">3. Handle upload image</h3><ul><li>Để đỡ phải lưu chữ hình ảnh trong đoạn văn bản dưới dạng base-64, chúng ta cần tích hợp một clould service và chỉ cần lưu lại đường link của ảnh đó.Tiếp theo đây mình sẽ hướng dẫn các bạn handle hành động upload của react-quill và sử dụng cloudinary để lưu trữ nó ( các bạn có thể làm tương tự với một cloud bất kỳ nào khác, ví dụ firebase storage, … )</li><li>Thêm imageHandler</li></ul><pre><code> &amp;lt;ReactQuill<br/>      ref={reactQuillRef}<br/>      theme=\"snow\"<br/>      placeholder=\"Start writing...\"<br/>      modules={{<br/>        toolbar: {<br/>          container: [<br/>             ...<br/>            [\"link\", \"image\", \"video\"],<br/>            [\"code-block\"],<br/>            [\"clean\"],<br/>          ],<br/>          handlers: {<br/>            image: imageHandler,   // &amp;lt;- <br/>          },<br/>        },<br/>        clipboard: {<br/>          matchVisual: false,<br/>        },<br/>      }}<br/>      ...<br/>    /&amp;gt;<br/></code></pre><pre><code>  const imageHandler = useCallback(() =&amp;gt; {<br/>    const input = document.createElement(\"input\");<br/>    input.setAttribute(\"type\", \"file\");<br/>    input.setAttribute(\"accept\", \"image/*\");<br/>    input.click();<br/>    input.onchange = async () =&amp;gt; {<br/>      if (input !== null &amp;amp;&amp;amp; input.files !== null) {<br/>        const file = input.files[0];<br/>        console.log(file)<br/>      }<br/>    };<br/>  }, []);<br/></code></pre><p>&gt; Giải thích : Ở đoạn code bên trên, mình viết thêm một hàm để handle container image của react-quill. Trong function imageHandler mình tạo ra một thẻ input file và gọi hàng click() để mở ra cửa sổ import file. Các bạn hoàn toàn có thể mở rộng phần này để mở lên upload widget của cloudinary ( <a href=\"https://cloudinary.com/documentation/react_image_and_video_upload\">đọc thêm</a> ). <strong>Upload với widget sẽ bảo mật và tối ưu hơn do chúng ta có thể tái sử dụng những ảnh đã upload trước đó, nếu có thời gian và cần thiết, các bạn nên dùng cách đó !</strong></p><ul><li>Function upload image lên cloudinary:<br/>Có nhiều cách upload lên cloudinary, nhưng mình chọn cách dùng cách gọi api vì nó đơn giản nhất:</li></ul><pre><code>const uploadToCloudinary = async (file: File): Promise&amp;lt;string&amp;gt; =&amp;gt; {<br/>  const formData = new FormData();<br/>  formData.append(\"file\", file);<br/>  formData.append(<br/>    \"upload_preset\",<br/>    import.meta.env.VITE_CLOUDINARY_PRESET<br/>  );<br/>  const res = await fetch(<br/>    `https://api.cloudinary.com/v1_1/${<br/>      import.meta.env.VITE_CLOUDINARY_NAME<br/>    }/upload`,<br/>    { method: \"POST\", body: formData }<br/>  );<br/>  const data = await res.json();<br/>  const url = data.url;<br/>  return url<br/>}<br/></code></pre><p>&gt; Giải thích: để upload ảnh lên cloudinary bằng api, các bạn cần có Product Name và upload<em>preset, các bạn có thể lấy từ trang setting của cloudinary ( bạn cần để mode của upload</em>preset là Unsigned, nếu muốn cách bảo mật hơn các bạn có thể dùng các cách upload khác của cloudinary )</p><p><img src=\"https://images.viblo.asia/03c32cf0-4050-4e52-a051-d36245b15d3a.png\" alt=\"image.png\" /></p><ul><li>Insert image url trả về từ cloudinary vào nội dung của đoạn văn bản</li></ul><pre><code>  const imageHandler = useCallback(() =&amp;gt; {<br/>    const input = document.createElement(\"input\");<br/>    input.setAttribute(\"type\", \"file\");<br/>    input.setAttribute(\"accept\", \"image/*\");<br/>    input.click();<br/>    input.onchange = async () =&amp;gt; {<br/>      if (input !== null &amp;amp;&amp;amp; input.files !== null) {<br/>        const file = input.files[0];<br/>        const url = await uploadToCloudinary(file);<br/>        const quill = reactQuillRef.current;<br/>        if (quill) {<br/>          const range = quill.getEditorSelection();<br/>          range &amp;amp;&amp;amp; quill.getEditor().insertEmbed(range.index, \"image\", url);<br/>        }<br/>      }<br/>    };<br/>  }, []);<br/></code></pre><p>&gt; Giải thích: Sau khi có được url từ việc upload lên cloudinary, chúng ta cần gán nó vào đúng vị trí của thẻ img tương ứng trong đoạn văn bản:</p><pre><code>const range = quill.getEditorSelection();<br/> range &amp;amp;&amp;amp; quill.getEditor().insertEmbed(range.index, \"image\", url);<br/></code></pre><p>&gt; Phần này chính là để xác định vị trí của thẻ img và gán nó với url trả về từ cloudinary ( trước đó hãy dùng useRef để tham chiếu đến ReactQuill component )</p><ul><li>Và đây là kết quả, lúc này nội dung văn bản chỉ còn chứa đường link của ảnh thay vì base-64:</li></ul><p><img src=\"https://images.viblo.asia/93823be1-eebe-4191-a6b9-b3c8c86171a0.png\" alt=\"image.png\" /></p><p>Toàn bộ source code có thể xem ở: https://github.com/phamquyetthang/react-quill-image-upload</p><h3 id=\"4ktlun\">4. Kết luận</h3><p>Trên đây là hướng dẫn đơn giản của mình để handle việc upload hình ảnh trong react-quill, các bạn có thể làm điều tương tự với việc upload video!</p><p>Các bạn có thể xem toàn bộ code của phần hướng dẫn trên trong github của mình: https://github.com/phamquyetthang/react-quill-image-upload</p><p>Hy vọng bài viết này hữu ích với bạn. Cảm ơn bạn đã đọc!</p><p>Nếu có bất kỳ câu hỏi hoặc ý kiến gì, hãy để lại bình luận bên dưới. Chúng ta có thể cùng nhau thảo luận về chủ đề này.</p>","title":"[React]: Upload ảnh và video trong rich text editor","tags":["cloudinary","React","react-editor","react-quill"],"created_at":1690542166000,"updated_at":1692512943000,"comments":[]}