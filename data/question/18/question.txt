{"content":"<h1 id=\"kubevpnlg\">KubeVPN là gì?</h1><p><img src=\"https://images.viblo.asia/0b96e9f4-9a6a-4e02-b454-d241fc1c7514.png\" alt=\"KubeVPN Tool\" /></p><p>KubeVPN là một công cụ cho phép bạn truy cập vào nội bộ (local) của cụm Kubernetes từ đó bạn có thể truy cập vào các tài nguyên trong cụm K8s đó như pod, service,… thông qua IP local của các tài nguyên đó. Chúng ta có thể tưởng tượng nếu VPN bình thường sẽ giúp chúng ta truy cập vào 1dải mạng private thì KubeVPN cũng vậy, KubeVPN giúp chúng ta truy cập vào dải mạng private của Kubernetes thông qua tunnel. Ngoài ra KubeVPN cung cấp 1 vài tính năng khác như:</p><ul><li>Cho phép bắt lưu lượng traffic vào các resource trên Kubernetes</li><li>Cho phép chạy Kubenetes Workload (Pods, Deployment,…) tại docker trên máy local</li><li>Copy file từ trong container ra máy local (cái này kubectl cũng làm được tuy nhiên kubevpn hỗ trợ copy thông qua 1 bastion host)</li></ul><h1 id=\"citkubevpn\">Cài đặt KubeVPN</h1><p>Link repo github KubeVPN: https://github.com/KubeNetworks/kubevpn</p><p>KubeVPN hiện hỗ trợ khá đầy đủ các nền tảng: MacOS, Linux, Windows.</p><p>Vì mình dùng Ubuntu nên trong bài này mình sẽ hướng dẫn cách cài đặt cho Ubuntu. Để cài đặt các bạn vào phần release (https://github.com/KubeNetworks/kubevpn/releases) của KubeVPN trên Github và tải về đúng phiên bản mình cần. Đối với Linux/Ubuntu các bạn có thể thực hiện như sau:</p><pre><code class=\"bash language-bash\"># Tải về file nén <br/>curl -L -O https://github.com/KubeNetworks/kubevpn/releases/download/v1.1.35/kubevpn_v1.1.35_linux_amd64.zip<br/># Giải nén bằng unzip<br/>unzip kubevpn_v1.1.35_linux_amd64.zip <br/></code></pre><p>Sau khi giải nén xong bạn có thể sử dụng command sau để kiểm tra đã giải nén thành công hay chưa</p><pre><code class=\"bash language-bash\">./bin/kubevpn<br/></code></pre><p>Output trả về thế này là thành công.</p><p><img src=\"https://images.viblo.asia/771c0fd9-75b0-4af6-a8fe-e119f9e6849f.png\" alt=\"image.png\" /></p><h1 id=\"sdngkubevpntruycpmngprivatekubernetes\">Sử dụng KubeVPN để truy cập mạng private Kubernetes</h1><p>Tất nhiên để kết nối đến cụm K8s ta cần có Kubeconfig, mặc định KubeVPN sẽ lấy kubeconfig tại path mặc định <code>~/.kube/config</code> trong môi trường thử nghiệm mình sẽ kết nối thử vào cụm K8s chạy thông qua minikube.</p><p>Để tạo kết nối đến cụm K8s ta sử dụng câu lệnh:</p><pre><code>./bin/kubevpn connect<br/></code></pre><p>Khi thực hiện kết nối bạn sẽ thấy có deployment có tên <strong>kubevpn-traffic-manager</strong> sẽ được tạo trong cụm K8s dùng để mở tunnel giữa máy local và cụm K8s.</p><p>Output:</p><p><img src=\"https://images.viblo.asia/b793ba63-3bb1-4b06-a2fd-a4c703f7c5ec.png\" alt=\"image.png\" /></p><p><img src=\"https://images.viblo.asia/d7c2ec72-2cd8-4650-a9cb-508fe98e4eb7.png\" alt=\"image.png\" /></p><p>Nó kêu <strong>Enjoy it</strong> là được rồi nha! 🤣🤣🤣</p><p>Để test mình sẽ deploy thử 1 pod chạy nginx để xem có truy cập được qua IP Local K8s hay không, sử dụng câu lệnh sau để tạo pod:</p><pre><code class=\"bash language-bash\">#Chạy pod có tên nginx sử dụng image nginx:latest<br/>kubectl run nginx --image=nginx<br/></code></pre><p><img src=\"https://images.viblo.asia/6b7ce3bf-e5a3-4419-8f86-4f8f8757cc39.png\" alt=\"image.png\" /></p><p>Ta thấy pod <strong>nginx</strong> có IP <strong>10.244.0.5</strong>, tiến hành truy cập thử trên broswer ta có kết quả:</p><p><img src=\"https://images.viblo.asia/83eef0a2-e2ba-4412-95dc-d763b591b406.png\" alt=\"image.png\" /></p><p>Như vậy giờ ta có thể truy cập vào các Pods, Services trong K8s trực tiếp thông qua IP và port để debug hay kiểm thử dễ dàng hơn rất nhiều.</p><h2 id=\"ktninmngk8sthngquabastionhost\">Kết nối đến mạng K8s thông qua bastion host</h2><p>Ngoài ra KubeVPN còn hỗ trợ bạn kết nối thông qua một hoặc nhiều bastion host, mô hình sẽ có dạng</p><p><img src=\"https://images.viblo.asia/cdb8826c-a991-4f94-8428-ab2ef4549eb0.png\" alt=\"image.png\" /></p><p>Ví dụ để kết nối đến cụm k8s mà chỉ có  thể truy cập được từ bastion host, câu lệnh sẽ có dạng như sau:</p><pre><code class=\"bash language-bash\">./bin/kubevpn connect --ssh-addr 172.16.5.29:22 --ssh-username viet --ssh-keyfile /home/hoangviet/.ssh/id_rsa<br/></code></pre><p>Trong đó <strong>172.16.5.29:22</strong> là địa chỉ IP và SSH Port của bastion host</p><p><strong>viet</strong> là username</p><p><strong>/home/hoangviet/.ssh/id_rsa</strong> là đường dẫn tới ssh private key</p><h1 id=\"kt\">Kết</h1><p>Hy vọng bài viết đã cung cấp được thêm một công cụ giúp các bạn thuận tiện hơn trong quá trình làm việc với Kubernetes.  Nếu thấy bài viết bổ ích và muốn tìm hiểu thêm nhiều công cụ DevOps khác thì cho mình 1 Upvote và Follow nhé! Thank all. 😁</p>","title":"KubeVPN công cụ giúp debug trên môi trường Kubernetes nhanh chóng và hiệu quả hơn","tags":["DevOps","DevOps Tool","Kubernetes","VPN","Kubevpn"],"created_at":1691742457000,"updated_at":1691983267000,"comments":[]}