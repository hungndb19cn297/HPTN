{"content":"<h1 id=\"kubevpnlg\">KubeVPN lÃ  gÃ¬?</h1><p><img src=\"https://images.viblo.asia/0b96e9f4-9a6a-4e02-b454-d241fc1c7514.png\" alt=\"KubeVPN Tool\" /></p><p>KubeVPN lÃ  má»™t cÃ´ng cá»¥ cho phÃ©p báº¡n truy cáº­p vÃ o ná»™i bá»™ (local) cá»§a cá»¥m Kubernetes tá»« Ä‘Ã³ báº¡n cÃ³ thá»ƒ truy cáº­p vÃ o cÃ¡c tÃ i nguyÃªn trong cá»¥m K8s Ä‘Ã³ nhÆ° pod, service,â€¦ thÃ´ng qua IP local cá»§a cÃ¡c tÃ i nguyÃªn Ä‘Ã³. ChÃºng ta cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng náº¿u VPN bÃ¬nh thÆ°á»ng sáº½ giÃºp chÃºng ta truy cáº­p vÃ o 1dáº£i máº¡ng private thÃ¬ KubeVPN cÅ©ng váº­y, KubeVPN giÃºp chÃºng ta truy cáº­p vÃ o dáº£i máº¡ng private cá»§a Kubernetes thÃ´ng qua tunnel. NgoÃ i ra KubeVPN cung cáº¥p 1 vÃ i tÃ­nh nÄƒng khÃ¡c nhÆ°:</p><ul><li>Cho phÃ©p báº¯t lÆ°u lÆ°á»£ng traffic vÃ o cÃ¡c resource trÃªn Kubernetes</li><li>Cho phÃ©p cháº¡y Kubenetes Workload (Pods, Deployment,â€¦) táº¡i docker trÃªn mÃ¡y local</li><li>Copy file tá»« trong container ra mÃ¡y local (cÃ¡i nÃ y kubectl cÅ©ng lÃ m Ä‘Æ°á»£c tuy nhiÃªn kubevpn há»— trá»£ copy thÃ´ng qua 1 bastion host)</li></ul><h1 id=\"citkubevpn\">CÃ i Ä‘áº·t KubeVPN</h1><p>Link repo github KubeVPN: https://github.com/KubeNetworks/kubevpn</p><p>KubeVPN hiá»‡n há»— trá»£ khÃ¡ Ä‘áº§y Ä‘á»§ cÃ¡c ná»n táº£ng: MacOS, Linux, Windows.</p><p>VÃ¬ mÃ¬nh dÃ¹ng Ubuntu nÃªn trong bÃ i nÃ y mÃ¬nh sáº½ hÆ°á»›ng dáº«n cÃ¡ch cÃ i Ä‘áº·t cho Ubuntu. Äá»ƒ cÃ i Ä‘áº·t cÃ¡c báº¡n vÃ o pháº§n release (https://github.com/KubeNetworks/kubevpn/releases) cá»§a KubeVPN trÃªn Github vÃ  táº£i vá» Ä‘Ãºng phiÃªn báº£n mÃ¬nh cáº§n. Äá»‘i vá»›i Linux/Ubuntu cÃ¡c báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n nhÆ° sau:</p><pre><code class=\"bash language-bash\"># Táº£i vá» file nÃ©n <br/>curl -L -O https://github.com/KubeNetworks/kubevpn/releases/download/v1.1.35/kubevpn_v1.1.35_linux_amd64.zip<br/># Giáº£i nÃ©n báº±ng unzip<br/>unzip kubevpn_v1.1.35_linux_amd64.zip <br/></code></pre><p>Sau khi giáº£i nÃ©n xong báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng command sau Ä‘á»ƒ kiá»ƒm tra Ä‘Ã£ giáº£i nÃ©n thÃ nh cÃ´ng hay chÆ°a</p><pre><code class=\"bash language-bash\">./bin/kubevpn<br/></code></pre><p>Output tráº£ vá» tháº¿ nÃ y lÃ  thÃ nh cÃ´ng.</p><p><img src=\"https://images.viblo.asia/771c0fd9-75b0-4af6-a8fe-e119f9e6849f.png\" alt=\"image.png\" /></p><h1 id=\"sdngkubevpntruycpmngprivatekubernetes\">Sá»­ dá»¥ng KubeVPN Ä‘á»ƒ truy cáº­p máº¡ng private Kubernetes</h1><p>Táº¥t nhiÃªn Ä‘á»ƒ káº¿t ná»‘i Ä‘áº¿n cá»¥m K8s ta cáº§n cÃ³ Kubeconfig, máº·c Ä‘á»‹nh KubeVPN sáº½ láº¥y kubeconfig táº¡i path máº·c Ä‘á»‹nh <code>~/.kube/config</code> trong mÃ´i trÆ°á»ng thá»­ nghiá»‡m mÃ¬nh sáº½ káº¿t ná»‘i thá»­ vÃ o cá»¥m K8s cháº¡y thÃ´ng qua minikube.</p><p>Äá»ƒ táº¡o káº¿t ná»‘i Ä‘áº¿n cá»¥m K8s ta sá»­ dá»¥ng cÃ¢u lá»‡nh:</p><pre><code>./bin/kubevpn connect<br/></code></pre><p>Khi thá»±c hiá»‡n káº¿t ná»‘i báº¡n sáº½ tháº¥y cÃ³ deployment cÃ³ tÃªn <strong>kubevpn-traffic-manager</strong> sáº½ Ä‘Æ°á»£c táº¡o trong cá»¥m K8s dÃ¹ng Ä‘á»ƒ má»Ÿ tunnel giá»¯a mÃ¡y local vÃ  cá»¥m K8s.</p><p>Output:</p><p><img src=\"https://images.viblo.asia/b793ba63-3bb1-4b06-a2fd-a4c703f7c5ec.png\" alt=\"image.png\" /></p><p><img src=\"https://images.viblo.asia/d7c2ec72-2cd8-4650-a9cb-508fe98e4eb7.png\" alt=\"image.png\" /></p><p>NÃ³ kÃªu <strong>Enjoy it</strong> lÃ  Ä‘Æ°á»£c rá»“i nha! ğŸ¤£ğŸ¤£ğŸ¤£</p><p>Äá»ƒ test mÃ¬nh sáº½ deploy thá»­ 1 pod cháº¡y nginx Ä‘á»ƒ xem cÃ³ truy cáº­p Ä‘Æ°á»£c qua IP Local K8s hay khÃ´ng, sá»­ dá»¥ng cÃ¢u lá»‡nh sau Ä‘á»ƒ táº¡o pod:</p><pre><code class=\"bash language-bash\">#Cháº¡y pod cÃ³ tÃªn nginx sá»­ dá»¥ng image nginx:latest<br/>kubectl run nginx --image=nginx<br/></code></pre><p><img src=\"https://images.viblo.asia/6b7ce3bf-e5a3-4419-8f86-4f8f8757cc39.png\" alt=\"image.png\" /></p><p>Ta tháº¥y pod <strong>nginx</strong> cÃ³ IP <strong>10.244.0.5</strong>, tiáº¿n hÃ nh truy cáº­p thá»­ trÃªn broswer ta cÃ³ káº¿t quáº£:</p><p><img src=\"https://images.viblo.asia/83eef0a2-e2ba-4412-95dc-d763b591b406.png\" alt=\"image.png\" /></p><p>NhÆ° váº­y giá» ta cÃ³ thá»ƒ truy cáº­p vÃ o cÃ¡c Pods, Services trong K8s trá»±c tiáº¿p thÃ´ng qua IP vÃ  port Ä‘á»ƒ debug hay kiá»ƒm thá»­ dá»… dÃ ng hÆ¡n ráº¥t nhiá»u.</p><h2 id=\"ktninmngk8sthngquabastionhost\">Káº¿t ná»‘i Ä‘áº¿n máº¡ng K8s thÃ´ng qua bastion host</h2><p>NgoÃ i ra KubeVPN cÃ²n há»— trá»£ báº¡n káº¿t ná»‘i thÃ´ng qua má»™t hoáº·c nhiá»u bastion host, mÃ´ hÃ¬nh sáº½ cÃ³ dáº¡ng</p><p><img src=\"https://images.viblo.asia/cdb8826c-a991-4f94-8428-ab2ef4549eb0.png\" alt=\"image.png\" /></p><p>VÃ­ dá»¥ Ä‘á»ƒ káº¿t ná»‘i Ä‘áº¿n cá»¥m k8s mÃ  chá»‰ cÃ³  thá»ƒ truy cáº­p Ä‘Æ°á»£c tá»« bastion host, cÃ¢u lá»‡nh sáº½ cÃ³ dáº¡ng nhÆ° sau:</p><pre><code class=\"bash language-bash\">./bin/kubevpn connect --ssh-addr 172.16.5.29:22 --ssh-username viet --ssh-keyfile /home/hoangviet/.ssh/id_rsa<br/></code></pre><p>Trong Ä‘Ã³ <strong>172.16.5.29:22</strong> lÃ  Ä‘á»‹a chá»‰ IP vÃ  SSH Port cá»§a bastion host</p><p><strong>viet</strong> lÃ  username</p><p><strong>/home/hoangviet/.ssh/id_rsa</strong> lÃ  Ä‘Æ°á»ng dáº«n tá»›i ssh private key</p><h1 id=\"kt\">Káº¿t</h1><p>Hy vá»ng bÃ i viáº¿t Ä‘Ã£ cung cáº¥p Ä‘Æ°á»£c thÃªm má»™t cÃ´ng cá»¥ giÃºp cÃ¡c báº¡n thuáº­n tiá»‡n hÆ¡n trong quÃ¡ trÃ¬nh lÃ m viá»‡c vá»›i Kubernetes.  Náº¿u tháº¥y bÃ i viáº¿t bá»• Ã­ch vÃ  muá»‘n tÃ¬m hiá»ƒu thÃªm nhiá»u cÃ´ng cá»¥ DevOps khÃ¡c thÃ¬ cho mÃ¬nh 1 Upvote vÃ  Follow nhÃ©! Thank all. ğŸ˜</p>","title":"KubeVPN cÃ´ng cá»¥ giÃºp debug trÃªn mÃ´i trÆ°á»ng Kubernetes nhanh chÃ³ng vÃ  hiá»‡u quáº£ hÆ¡n","tags":["DevOps","DevOps Tool","Kubernetes","VPN","Kubevpn"],"created_at":1691742457000,"updated_at":1691983267000,"comments":[]}