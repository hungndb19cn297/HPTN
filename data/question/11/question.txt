{"content":"<p>Hello má»i ngÆ°á»i tiáº¿p tá»¥c Series vÃ©n mÃ n sá»± tháº­t vá» Kafka cá»§a mÃ¬nh Link ğŸ‘‰ï¸ğŸ‘‰ï¸ğŸ‘‰ï¸  <a href=\"https://viblo.asia/s/series-ven-man-su-that-ve-apache-kafka-PAoJe8vN41j\">táº¡i Ä‘Ã¢y </a>  dÃ nh cho ace má»›i Ä‘á»c bÃ i viáº¿t cá»§a mÃ¬nh láº§n Ä‘áº§u. </p><p>VÃ  tiáº¿p tá»¥c cho<a href=\"https://viblo.asia/p/kafka-connect-la-gi-minh-da-dung-kafka-connect-de-dong-bo-du-lieu-nhu-the-nao-phan-1-Ny0VGjX8LPA\"> bÃ i trÆ°á»›c</a> vÃ  pháº§n 2 cá»§a Kafka connect thÃ¬ nhÆ° tiÃªu Ä‘á» mÃ¬nh hÃ´m nay mÃ¬nh sáº½ viáº¿t bÃ i chi tiáº¿t cÃ¡c bÆ°á»›c Ä‘á»ƒ cáº¥u hÃ¬nh lÃªn 1 cá»¥m Kafka Cluster cháº¡y cho mÃ´i trÆ°á»ng Production . </p><p>BÃ i nÃ y cáº§n ae pháº£i Ä‘Ã£ cÃ i Ä‘áº·t Ä‘Æ°á»£c má»™t Single Node cá»§a Kafka thÃ¬ sáº½ dá»… hiá»ƒu vÃ  cáº¥u hÃ¬nh hÆ¡n. Tham kháº£o bÃ i viáº¿t cÃ i Ä‘áº·t cá»§a mÃ¬nh <a href=\"https://viblo.asia/p/cai-dat-cau-hinh-zookeeper-va-kafka-tren-ubuntu-2004-chi-tiet-018J259a4YK\"> táº¡i Ä‘Ã¢y </a>  hoáº·c KÃªnh Youtube cá»§a mÃ¬nh táº¡i ğŸ‘‰ï¸ğŸ‘‰ï¸ğŸ‘‰ï¸ğŸ‘‰ï¸<br/><a href=\"https://www.youtube.com/watch?v=-EAjo27JtYA\">Link full HD </a>   ğŸ˜€ğŸ˜€ğŸ˜€ Cáº£m Æ¡n anh em!!! </p><p>Ae chuáº©n bá»‹ cho mÃ¬nh má»™t ly trÃ  khÃ´ng trÃ  thÃ¬ nÆ°á»›c mÃ¡t láº¡nh cho tá»‰nh tÃ¡o vÃ  ngá»“i ngay ngáº¯n hoáº·c chuáº©n bá»‹ sáºµn mÃ¡y Ä‘á»ƒ vÃ o viá»‡c nhÃ© ae ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜† . </p><p>**Let's go **</p><p>CÅ©ng giá»‘ng nhÆ° <a href=\"https://viblo.asia/p/cai-dat-cau-hinh-zookeeper-va-kafka-tren-ubuntu-2004-chi-tiet-018J259a4YK\">bÃ i cÃ i Ä‘áº·t</a> hÃ´m trÆ°á»›c  mÃ¬nh sáº½ cÃ³ danh sÃ¡ch nhÆ° sau: </p><ol><li>Má»™t vÃ i thÃ´ng tin yÃªu cáº§u</li><li>Setup má»Ÿ port trÃªn cÃ¡c mÃ¡y broker</li><li>Cáº¥u hÃ¬nh Zookeeper Cluster. </li><li>Cáº¥u hÃ¬nh Kafka Cluster</li><li>CÃ i Ä‘áº·t Kafdrop </li><li>View vÃ  thao tÃ¡c vá»›i cá»¥m Kafka Cluster trÃªn Kafdrop UI</li></ol><p></p><p>ÄÃ£ xong pháº§n giá»›i thiá»‡u ta Ä‘i báº¯t tay vÃ o cÃ´ng viá»‡c nhÃ©. </p><p>Trong bÃ i viáº¿t nÃ y mÃ¬nh dÃ¹ng 3 mÃ¡y cÃ¹ng 1 dáº£i máº¡ng </p><p>| NAME      |   IP | <br/>| --------      | -------- <br/>| vm-01     | 192.168.1.121<br />| vm-02     | 192.168.1.120 <br/>| vm-03     | 192.168.1.122</p><h3 id=\"1mtvithngtinyucu\">1. Má»™t vÃ i thÃ´ng tin yÃªu cáº§u</h3><ul><li>Thá»© nháº¥t lÃ  vá» mÃ¡y Ä‘á»ƒ cÃ i thÃ¬ cáº§n tá»‘i thiá»ƒu lÃ  3 mÃ¡y vá»›i cáº¥u hÃ¬nh tá»‘i thiá»ƒu 4GB RAM </li><li>CÃ¡c mÃ¡y cÃ³ thá»ƒ cÃ¹ng hoáº·c khÃ´ng cÃ¹ng trong cÃ¹ng 1 dáº£i máº¡ng Ä‘Æ°á»£c setup má»Ÿ port </li><li>VÃ  Ä‘Æ°Æ¡ng nhiÃªn lÃ  ae Ä‘Ã£ setup Ä‘á»§ tá»‘i thiá»ƒu 3 mÃ¡y Ä‘á»ƒ cáº¥u hÃ¬nh join láº¡i thÃ nh 1 cá»¥m Cluster ğŸ˜†ğŸ˜†ğŸ˜†</li></ul><p>**** LÆ°u Ã½:  Khi setup Kafka Cluster sá»­ dá»¥ng Zookeeper thÃ¬ sá»‘ mÃ¡y Broker tham gia vÃ o 1 cá»¥m cluster sáº½ lÃ  sá»‘ láº»  vÃ  tá»‘i thiá»ƒu lÃ  3 mÃ¡y . </p><h3 id=\"2cuhnhmportgiaccmy\">2. Cáº¥u hÃ¬nh má»Ÿ Port giá»¯a cÃ¡c mÃ¡y</h3><p>MÃ¬nh sá»­ dá»¥ng <code>ufw</code>  Ä‘á»ƒ má»Ÿ port </p><p>Kiá»ƒm tra <code>ufw</code> cÃ³ Ä‘ang Active hay khÃ´ng </p><pre><code>sudo ufw status<br/></code></pre><p>Náº¿u Ä‘ang á»Ÿ trang thÃ¡i: <code>inactive</code> thÃ¬ dÃ¹ng lá»‡nh sau Ä‘á»ƒ active nÃ³ lÃªn. </p><pre><code>sudo ufw enable<br/></code></pre><p>Tiáº¿p tá»¥c mÃ¬nh sáº½ dÃ¹ng lá»‡nh Ä‘á»ƒ má»Ÿ 2 port 2181 cá»§a Zookeeper vÃ  9092 cho cÃ¡c mÃ¡y trong cÃ¹ng 1 dáº£i máº¡ng  cÃ³ thá»ƒ connect Ä‘Æ°á»£c tá»›i 2 port nÃ y. </p><p>Má»Ÿ port 2181</p><pre><code>sudo ufw allow from 192.168.1.0/24 to any port 2181 proto tcp<br/></code></pre><p>Má»Ÿ Port 9092</p><pre><code>sudo ufw allow from 192.168.1.0/24 to any port 9092 proto tcp<br/></code></pre><p>Hoáº·c cÃ³ thá»ƒ dÃ¹ng lá»‡nh Ä‘á»ƒ chi rÃµ IP nguá»“n IP Ä‘Ã­ch, Port vÃ  Protocol tÆ°Æ¡ng á»©ng nhÆ° sau: </p><pre><code>sudo ufw allow from 192.168.1.121 to any port 9092 proto tcp<br/></code></pre><p>ğŸ‘‰ï¸ğŸ‘‰ï¸ğŸ‘‰ï¸ğŸ‘‰ï¸ Ae thá»±c hiá»‡n láº§n lÆ°á»£t trÃªn tá»«ng mÃ¡y cÃ²n láº¡i nhÃ©, bÆ°á»›c nÃ y cÅ©ng khÃ¡ quan trá»ng vÃ¬ cÃ¡c mÃ¡y báº¯t buá»™c pháº£i káº¿t ná»‘i Ä‘Æ°á»£c tá»›i cÃ¡c port cá»§a nhau nhÃ©!!!!  </p><h3 id=\"3cuhnhzookeepercluster\">3. Cáº¥u hÃ¬nh Zookeeper Cluster</h3><p>TrÃªn file <code>zookeeper.properties</code> trong thÆ° má»¥c <code>config</code> á»Ÿ má»—i mÃ¡y sau khi ae Ä‘Ã£ táº£i giáº£i nÃ©n báº£n Relase vÃ  cÃ i Kafka single Note. </p><p>á» Ä‘Ã¢y cá»§a mÃ¬nh sáº½ lÃ  Ä‘Æ°á»£c dáº«n <code>/home/kafka/download/kafka/config</code> </p><p>BÆ°á»›c 1 : MÃ¬nh sáº½ táº¡o 2 thÆ° má»¥c chá»©a data vÃ  log cá»§a tháº±ng Zookeeper táº¡i : </p><p><code>/home/kafka/zookeeper/logs</code></p><p><code>/home/kafka/zookeeper/data-logs</code></p><p>***  LÆ°u Ã½:  viá»‡c Kafka cÃ³ bá»‹ máº¥t data hay khÃ´ng nÃ³ cÅ©ng phá»¥ thuá»™c vÃ o 2 Ä‘Æ°á»ng dáº«n nÃ y nhÃ© nÃªn ae lÆ°u Ã½ khi táº¡o thÆ° má»¥c nÃ y </p><p>BÆ°á»›c 2: Trong thÆ° má»¥c    <code>/home/kafka/zookeeper/logs</code> mÃ¬nh sáº½ táº¡o 1 file <code>myid</code> vÃ  sá»­a ná»™i dung file sáº½ chá»©a 1 sá»‘ nguyÃªn tÃ¹y chá»n vÃ  nÃ³ sáº½ lÃ  <code>id</code> cá»§a zookeeper trong cá»¥m cluster. </p><p>BÆ°á»›c 3:  MÃ¬nh dÃ¹ng lá»‡nh <code>vi</code> vÃ  chá»‰nh sá»­a ná»™i dung cá»§a file  <code>zookeeper.properties</code> nhÆ° sau: </p><p><img src=\"https://images.viblo.asia/073768a1-997d-49b6-ab2e-43f9a1fae0f3.png\" alt=\"image.png\" /></p><p>MÃ¬nh thÃªm 2 tham sá»‘:  <code>dataDir</code> vÃ   <code>dataLogDir</code> Ä‘iá»n giÃ¡ trá»‹ lÃ  2 Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng á»©ng mÃ¬nh Ä‘Ã£ táº¡o á»Ÿ BÆ°á»›c 1 </p><pre><code>dataDir=/home/kafka/zookeeper/logs<br/> dataLogDir=/home/kafka/zookeeper/data-logs<br/></code></pre><p>cÃ¡c tham sá»‘ <code>Port</code> mÃ¬nh Ä‘á»ƒ máº·c Ä‘á»‹nh vÃ  </p><pre><code>  maxClientCnxns=60<br/>  admin.enableServer=false<br/></code></pre><p>CÃ¡c tham sá»‘ báº¯t buá»™c pháº£i cÃ³ bao gá»“m:  (Vá» cÃ¡c tham sá»‘ nÃ y mÃ¬nh sáº½ giáº£i thÃ­ch á»Ÿ má»™t bÃ i sá»›m nháº¥t nhÃ© ae  ğŸ˜†ğŸ˜†ğŸ˜†)</p><pre><code>tickTime=2000<br/>initLimit=10<br/>syncLimit=5<br/>4lw.commands.whitelist=*<br/></code></pre><p>Tiáº¿p theo tham sá»‘ nÃ y quan trá»ng. </p><pre><code>server.1=192.168.1.121:2888:3888<br/>server.2=192.168.1.120:2888:3888<br/>server.3=192.168.1.122:2888:3888<br/></code></pre><p>cáº¥u trÃºc cá»§a tham sá»‘ trÃªn nhÆ° sau: </p><p>server.&lt;myid&gt;=&lt;hostname&gt;:&lt;leaderport&gt;:&lt;electionport&gt;</p><p><code>myid</code> nÃ³ chÃ­nh lÃ  <code>id</code> trong file <code>myid</code> mÃ¬nh Ä‘Ã£ táº¡o á»Ÿ BÆ°á»›c 2 </p><p><code>leaderport</code> : trong 1 thá»i Ä‘iá»ƒm chá»‰ cÃ³ 1 Zookeeper lÃ m <code>leader</code> nÃªn Ä‘Ã¢y sáº½ lÃ  <code>Port</code> Ä‘á»ƒ cÃ¡c mÃ¡y follower connect tá»›i   </p><p><code>electionport</code>: Sá»­ dá»¥ng cho viá»‡c bÃ¬nh báº§u follower lÃªn lÃ m <code>leader</code> </p><p>á»Ÿ Ä‘Ã¢y mÃ¬nh cÃ³ 3 mÃ¡y vÃ  cÃ³ 3  nÃªn sáº½ cÃ³ 3 id lÃ  1, 2 vÃ  3 tÆ°Æ¡ng á»©ng vá»›i 3 mÃ¡y mÃ¬nh Ä‘Ã£ táº¡o á»Ÿ BÆ°á»›c 2 . </p><p>AE tiáº¿p tá»¥c thá»±c hiá»‡n 3 bÆ°á»›c nÃ y trÃªn cÃ¡c mÃ¡y cÃ²n láº¡i. </p><p>Sau Khi chá»‰nh sá»­a file cáº¥u hÃ¬nh xong ae thá»±c hiá»‡n restart láº¡i zookeeper </p><pre><code> sudo systemctl restart zookeeper.service<br/></code></pre><p>(TH ae chÆ°a setup service systemd thÃ¬ ae cÃ³ thá»ƒ dÃ¹ng lá»‡nh <code>zookeeper-server-stop.sh</code> <code>zookeeper-server-start.sh</code> vÃ   trong thÆ° má»¥c <code>bin</code> nhÃ© ğŸ˜„)   </p><h3 id=\"4cuhnhjoinkafkacluster\">4. Cáº¥u hÃ¬nh Join Kafka Cluster.</h3><p>Váº«n trong thÆ° má»¥c <code>config</code> trÃªn má»—i mÃ¡y </p><p>MÃ¬nh sáº½ <code>vi</code> file <code>server.properties</code> lÃªn vÃ  chá»‰nh sá»­a nhÆ° sau: </p><p>CÃ¡c tham sá»‘ quan trá»ng trong file cáº§n pháº£i cáº¥u hÃ¬nh ngoÃ i ra cÃ¡c tham sá»‘ khÃ¡c ae cÃ³ thá»ƒ tÃ¬m hiá»ƒu vÃ  trong khi váº­n hÃ nh vÃ  chá»‰nh sá»­a sao cho phÃ¹ há»£p. </p><p>TrÃªn mÃ¡y 192.168.1.121 cá»§a mÃ¬nh sá»­a cáº¥u hÃ¬nh 1 sá»‘ cÃ¡c tham sá»‘ nhÆ° sau: </p><pre><code>   broker.id=1<br/>    listeners=PLAINTEXT://0.0.0.0:9092 <br/>    advertised.listeners=PLAINTEXT://192.168.1.121:9092<br/>    log.dirs=/home/kafka/logs<br/>    zookeeper.connect=localhost:2181,192.168.1.120:2181,192.168.1.122:2181<br/></code></pre><p><strong>LÃ½ do</strong></p><p>Khi join cluster thÃ¬ cÃ¡c kafka node pháº£i cÃ³ id khÃ¡c nhau </p><p><code>log.dirs</code>  chá»— nÃ y chá»©a 1 sá»‘ thÃ´ng tin quan trá»ng nhÆ° meta.properties Ä‘á»ƒ cÃ³ thá»ƒ start 1 cá»¥m cluster nÃªn cÅ©ng cáº§n pháº£i cáº©n tháº­n</p><p>vÃ  2 tha sá»‘ khi Ä‘á»ƒ cáº¥u hÃ¬nh cho cÃ¡c service trong cÃ¹ng 1 dáº£i máº¡ng cÃ³ thá»ƒ connect tá»›i kafka</p><p>VÃ  Tham sá»‘ quan trá»ng tiáº¿p theo </p><pre><code>    zookeeper.connect=localhost:2181,192.168.1.120:2181,192.168.1.122:2181<br/></code></pre><p>ChÃ­nh lÃ  tham sá»‘ Ä‘á»ƒ connect tá»›i cá»¥m Cluster Zookeeper Ä‘Ã£ cáº¥u hÃ¬nh á»Ÿ bÃªn trÃªn. </p><p>AE thá»±c hiá»‡n cáº¥u hÃ¬nh cÃ¡c tham sá»‘ bÃªn trÃªn vá»›i cÃ¡c mÃ¡y cÃ²n láº¡i </p><p>Sau khi cáº¥u hÃ¬nh trÃªn cÃ¡c mÃ¡y xong nhá»›  thá»±c hiá»‡n   restart láº¡i cÃ¡c mÃ¡y Kafka nhÃ©. </p><pre><code>systemctl restart kafka.service<br/></code></pre><p>Hoáº·c cÃ³ thá»ƒ dÃ¹ng lá»‡nh sh start, stop trong thÆ° má»¥c <code>bin</code></p><p>Oke Tá»›i Ä‘Ã¢y lÃ  quÃ¡ trÃ¬nh Ä‘Ã£ gáº§n hoÃ n thiá»‡n cho 1 cá»¥m Cluster    </p><h3 id=\"5cikafdropui\">5. CÃ i Kafdrop UI</h3><p>YÃªu cáº§u: mÃ¡y Ä‘Ã£ cÃ i Java JDK </p><p>BÆ°á»›c 1: Táº¡o 1 thÆ° má»¥c </p><pre><code>mkdir  ~/kafdrop &amp;amp;&amp;amp; cd kafdrop<br/></code></pre><p>BÆ°á»›c 2:  Táº£i file <code>jar</code> Kafdrop</p><pre><code>wget https://github.com/obsidiandynamics/kafdrop/releases/download/3.28.0/kafdrop-3.28.0.jar<br/></code></pre><p>BÆ°á»›c 3: táº¡o service systemd cho kafdrop</p><pre><code>vi /etc/systemd/system/kafdrop.service<br/></code></pre><p>BÆ°á»›c 4: Ä‘iá»n thÃ´ng tin file vá»›i tham sá»‘ IP cá»§a cÃ¡c mÃ¡y Kafka tÆ°Æ¡ng á»©ng </p><pre><code>   [Unit]<br/>Description=Kafdrop server<br/>Documentation=https://github.com/obsidiandynamics/kafdrop<br/>Requires=network.target remote-fs.target<br/>After=network.target remote-fs.target<br/>[Service]<br/>Type=simple<br/>ExecStart=/bin/java --add-opens=java.base/sun.nio.ch=ALL-UNNAMED \\<br/>    -jar /home/kafka/kafdrop/kafdrop-3.28.0.jar \\<br/>    --kafka.brokerConnect=localhost:9092,192.168.1.121:9092,192.168.1.120:9092 --server.port=9010 --management.server.port=9010 \\ <br/>Restart=on-abnormal<br/>[Install]<br/>WantedBy=multi-user.target<br/></code></pre><p>BÆ°á»›c 5: Start Kafdrop vÃ  má»Ÿ Port <code>9010</code> cá»§a Kafdrop </p><pre><code>systemctl start kafdrop.service<br/> systemctl enable kafdrop.service<br/>sudo ufw allow from 192.168.1.0/24 to any port 9010 proto tcp<br/></code></pre><h3 id=\"6kimtrathnhqu\">6. Kiá»ƒm tra thÃ nh quáº£ .</h3><p><img src=\"https://images.viblo.asia/60317460-59d7-42be-b678-db135555314e.png\" alt=\"image.png\" /></p><p>BÃ i viáº¿t hÃ´m nay cÅ©ng khÃ¡ dÃ i, cáº£m Æ¡n all ace Ä‘Ã£ Ä‘á»c bÃ i viáº¿t cá»§a mÃ¬nh nhÃ©, Ae cho mÃ¬nh xin 1 Vote vÃ  chá» bÃ i viáº¿t tiáº¿p theo nhÃ© </p><p>TrÃ¢n thÃ nh cáº£m Æ¡n anh em !</p>","title":"CÃ i Ä‘áº·t Kafka Cluster  cho mÃ´i trÆ°á»ng Production, Sá»­ dá»¥ng Kafdrop UI Ä‘á»ƒ View vÃ  thao tÃ¡c","tags":["cluster","kafka","zookeeper","kafdrop","kafka cluster"],"created_at":1691833402000,"updated_at":1691983329000,"comments":[{"id":56003,"hash_id":"5OXLAlgYJGr","user_id":27812,"level":0,"points":1,"rated_value":0,"commentable_type":"Post","commentable_id":70782,"in_reply_to_comment":null,"in_reply_to_user":null,"created_at":"2023-08-12T19:45:41+07:00","updated_at":"2023-08-14T05:00:20+07:00","deleted_at":null,"edited_at":"2023-08-12T19:45:57+07:00","contents":"Kafka ui dÃ¹ng Redpanda Console cÃ³ váº» tiá»‡n hÆ¡n, mÃ¬nh tá»«ng dÃ¹ng máº¥y tháº±ng nhÆ°ng tháº¥y tháº±ng nÃ y á»•n nháº¥t","contents_short":"Kafka ui dÃ¹ng Redpanda Console cÃ³ váº» tiá»‡n hÆ¡n, mÃ¬nh tá»«ng dÃ¹ng máº¥y tháº±ng nhÆ°ng tháº¥y tháº±ng nÃ y á»•n nháº¥t","user":{"data":{"id":27812,"url":"https://viblo.asia/u/xdorro","avatar":"b62fe4b0-1499-4851-a0fe-7d0ca07b11ff.jpg","name":"Anh Nguyen","username":"xdorro","followers_count":0,"reputation":57,"posts_count":0,"banned_at":null,"level_partner":null}}},{"id":56004,"hash_id":"obA46XwMLKv","user_id":60533,"level":1,"points":1,"rated_value":0,"commentable_type":"Post","commentable_id":70782,"in_reply_to_comment":56003,"in_reply_to_user":"xdorro","created_at":"2023-08-12T20:02:25+07:00","updated_at":"2023-08-14T05:00:20+07:00","deleted_at":null,"edited_at":"2023-08-12T20:02:25+07:00","contents":"mÃ¬nh má»›i dÃ¹ng tháº±ng Kafdrop nÃ y vÃ  AKHQ, nÃ o ráº£nh mÃ¬nh sáº½ thá»­ tráº£i nghiá»‡m Redpanda Console ğŸ˜ƒ","contents_short":"mÃ¬nh má»›i dÃ¹ng tháº±ng Kafdrop nÃ y vÃ  AKHQ, nÃ o ráº£nh mÃ¬nh sáº½ thá»­ tráº£i nghiá»‡m Redpanda Console ğŸ˜ƒ","user":{"data":{"id":60533,"url":"https://viblo.asia/u/dohv","avatar":"fc4704f5-0141-4229-a144-400037a8ffa4.png","name":"dohv","username":"dohv","followers_count":13,"reputation":374,"posts_count":6,"banned_at":null,"level_partner":null}}}]}